<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.casemng.repository.ProductMapper">

	<select id="findAll" resultMap="prod">
		select
		product.id,
		product.product_name,
		product.price,
		product.stock,
		product.is_choose
		
		from
		product
	</select>
	
	<select id="findAllForSelect" resultMap="prod">
		select
		product.id,
		product.product_name,
		product.price,
		product.stock,
		product.is_choose
		
		from
		product
		where
		product.is_choose = 0
	</select>
	
	<select id="findAllForSelectStock" resultMap="prod">
		select
		product.id,
		product.product_name,
		product.price,
		product.stock,
		product.is_choose
		
		from
		product
		where
		product.is_choose = 0
		and product.stock > 0
	</select>
	
	<select id="findById" resultMap="prod">
		select
		product.id,
		product.product_name,
		product.price,
		product.stock,
		product.is_choose
		
		from
		product
		where
		product.id = #{id}
	</select>
	
	<update id="edit">
		update product
		set
		product_name = #{productName},
		price = #{price},
		stock = #{stock},
		is_choose = #{choose}
		where
		id = #{id}
	</update>
	
	<!-- h2 -->
	<update id="editStock" parameterType="java.util.List">
		<foreach collection="list" item="item" separator=";">
			UPDATE product
			SET
			id = #{item.productId},
			stock = stock - #{item.quantity}
			WHERE
			id = #{item.id}
		</foreach>
	</update>
	
	<!-- MySQL
	<update id="editStock" parameterType="java.util.List">
		update product
		set
		stock = elt(field(id,
		<foreach collection="list" item="item" separator=",">
			#{item.id}
		</foreach>
		),
		<foreach collection="list" item="item" separator=",">
			stock - #{item.quantity}
		</foreach>
		)
		where
		id IN
		(
		<foreach collection="list" item="item" separator=",">
			#{item.productId}
		</foreach>
		)
	</update>
	 -->
	
	<insert id="create">
		insert into product
		(
		product_name,
		price,
		stock,
		is_choose
		)
		values
		(
		#{productName},
		#{price},
		#{stock},
		#{choose}
		)
	</insert>
	
	<resultMap type="com.example.casemng.entity.Product" id="prod">
		<id property="id" column="id" />
		<result property="productName" column="product_name" />
		<result property="price" column="price" />
		<result property="stock" column="stock" />
		<result property="choose" column="is_choose" />
	</resultMap>
	
</mapper>